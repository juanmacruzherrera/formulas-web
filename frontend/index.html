<!DOCTYPE html>
<html lang="es" class="dark" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Fórmulas Matemáticas</title>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS + DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Plotly.js para gráficos interactivos -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- MathJax para renderizar fórmulas LaTeX -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script>
        // Configuración de MathJax ANTES de cargar el script
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['$$', '$$']],
                processEscapes: true
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Estilos custom -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Configuración Tailwind -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-900 text-slate-50 font-sans antialiased min-h-screen">

    <!-- HEADER -->
    <header class="bg-slate-800 shadow-lg border-b border-slate-700">
        <div class="container mx-auto px-4 py-4">
            <!-- Línea superior: Logo + Estado -->
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-slate-50">Visualizador de Fórmulas</h1>
                        <p class="text-xs text-slate-400">Matemáticas y Física Interactivas</p>
                    </div>
                </div>
                <div class="badge badge-md bg-blue-500 text-white border-0">
                    <span class="loading loading-ring loading-xs mr-2" id="statusIndicator"></span>
                    <span id="statusText">Conectado</span>
                </div>
            </div>

            <!-- Tabs 2D/3D -->
            <div class="flex items-center gap-2">
                <button id="tab2D" class="tab-redesign tab-active">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" />
                    </svg>
                    <span>Gráficos 2D</span>
                </button>
                <button id="tab3D" class="tab-redesign">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                    </svg>
                    <span>Gráficos 3D</span>
                </button>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="container mx-auto px-4 py-6">

        <!-- Grid 2 columnas: Gráfico (75%) + Panel (25%) -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">

            <!-- ÁREA DE VISUALIZACIÓN: Gráfico (IZQUIERDA - 75%) -->
            <div class="lg:col-span-3">
                <div class="card bg-slate-800 shadow-xl border border-slate-700" style="min-height: calc(100vh - 200px);">
                    <div class="card-body p-4">
                        <!-- Contenedor del gráfico Plotly -->
                        <div id="graficoContainer" class="w-full" style="min-height: calc(100vh - 240px);">
                            <!-- Mensaje inicial -->
                            <div id="placeholderGrafico" class="flex flex-col items-center justify-center h-full text-slate-400 space-y-4" style="min-height: calc(100vh - 240px);">
                                <svg class="w-24 h-24 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" />
                                </svg>
                                <p class="text-lg">Selecciona una fórmula y haz clic en <strong class="text-blue-400">Calcular</strong></p>
                                <p class="text-sm text-slate-500">El gráfico interactivo aparecerá aquí</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PANEL DERECHO: Controles (DERECHA - 25%) -->
            <div class="lg:col-span-1">
                <!-- Grid horizontal: selector, variables, historial -->
                <div class="card bg-slate-800 shadow-xl border border-slate-700">
                    <div class="card-body">
                        <h2 class="card-title text-blue-400 mb-4">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                            </svg>
                            Configuración
                        </h2>

                        <!-- Selector de fórmula -->
                        <div class="form-control w-full">
                            <label class="label">
                                <span class="label-text text-slate-300 font-medium">Seleccionar Fórmula</span>
                            </label>
                            <select id="formulaSelector" class="select select-bordered bg-slate-700 text-slate-100 w-full border-slate-600 focus:border-blue-500">
                                <option disabled selected>Cargando fórmulas...</option>
                            </select>
                        </div>

                        <!-- Fórmula LaTeX -->
                        <div class="mt-4 p-4 bg-slate-700 rounded-lg border border-slate-600">
                            <p class="text-xs text-slate-400 mb-2">Fórmula:</p>
                            <div id="formulaDisplay" class="text-center text-lg overflow-x-auto">
                                $$...$$
                            </div>
                        </div>

                        <!-- Categoría -->
                        <div class="mt-2">
                            <span id="categoriaDisplay" class="badge badge-outline border-blue-400 text-blue-400"></span>
                        </div>

                        <!-- Inputs dinámicos -->
                        <div id="inputsContainer" class="mt-6 space-y-3">
                            <!-- Se generan dinámicamente con JavaScript -->
                        </div>

                        <!-- Botón Calcular -->
                        <button id="btnCalcular" class="btn btn-primary w-full mt-6 bg-blue-500 hover:bg-blue-600 border-0 text-white shadow-lg shadow-blue-500/50">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                            </svg>
                            Calcular y Graficar
                        </button>

                        <!-- HISTORIAL DE CÁLCULOS (Colapsable) -->
                        <div class="collapse collapse-arrow bg-slate-700 mt-6 border border-slate-600">
                            <input type="checkbox" id="toggleHistorial" />
                            <div class="collapse-title text-sm font-medium text-blue-400 flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                Historial
                                <button id="btnRefrescarHistorial" class="btn btn-xs btn-ghost text-slate-400 hover:text-blue-400 ml-auto" onclick="event.stopPropagation();">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                    </svg>
                                </button>
                            </div>
                            <div class="collapse-content">
                                <!-- Contenedor de cards de historial (vertical) -->
                                <div id="historialContainer" class="space-y-2 max-h-96 overflow-y-auto">
                                    <!-- Se generan dinámicamente con JavaScript -->
                                    <p class="text-slate-400 text-xs">Cargando historial...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="bg-slate-800 border-t border-slate-700 mt-12">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row items-center justify-between text-sm text-slate-400">
                <p>
                    Proyecto educativo - Visualización de Fórmulas Matemáticas
                </p>
                <p class="mt-2 md:mt-0">
                    Stack: <span class="text-blue-400">FastAPI</span> +
                    <span class="text-blue-400">Supabase</span> +
                    <span class="text-blue-400">Plotly.js</span>
                </p>
            </div>
        </div>
    </footer>

    <!-- Toast notifications (DaisyUI) -->
    <div class="toast toast-end" id="toastContainer">
        <!-- Notificaciones dinámicas -->
    </div>

    <!-- Scripts: Orden de carga importante -->
    <script src="js/api.js"></script>
    <script src="js/animacion.js"></script>
    <script src="js/graficos.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
